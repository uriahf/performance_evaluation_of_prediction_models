---
title: "Performance Evaluation of Prediction Models"
author: "Uriah Finkel"
format:
  revealjs:
    theme:  [solarized, custom.scss]
    incremental: true
---

## Agenda

-   Introduction to performance metrics and curves for prediction models.

-   For medical prediction models the most common outcome is a binary outcome, therefore this will be the focus of the lecture.

## Code for Performance Metrics and Curves

All interactive plots in this presentation were created with [**rtichoke**](https://uriahf.github.io/rtichoke/) (I am the author üëã).

You are also invited to explore [**rtichoke blog**](https://rtichoke-blog.netlify.app/) for reproducible examples and some theory.

## rtichoke blog {background-iframe="https://rtichoke-blog.netlify.app"}

## Motivation

### Why using performance metrics? ü§î

-   Choosing between different candidate models.
-   Choosing between candidate features

### Relevant Criteria besides Performance

-   How difficult is it to implement the model?

-   How difficult is it to explain the model?

## Categories of Performance Metrics and Curves

-   **Discrimination**: Model's ability to separate between events and non-events.

-   **Calibration**: Agreement between predicted probabilities and the prevalence of the outcomes.

-   **Utility**: The usefulness of the model in terms of decision-making.

## Colors

::: columns
::: {.column width="50%"}
### [Green]{style="color: green;"} {style="font-size: 100px;"}

### **üôÇ** {style="text-align: center; font-size: 180px;"}
:::

::: {.column width="50%"}
### [Red]{style="color: red;"} {style="font-size: 100px;"}

### **üôÅ** {style="text-align: center; font-size: 180px;"}
:::
:::

## Colors

::: columns
::: {.column width="50%"}
### [Green]{style="color: green;"} {style="font-size: 100px;"}

![](Maccabi_Haifa_FC_logo.svg){fig-align="center" width="200"}
:::

::: {.column width="50%"}
### [Red]{style="color: red;"} {style="font-size: 100px;"}

::: {style="height:49px; width:100%; clear:both;"}
:::

![](Hapoel_Haifa_Football_Club_Logo.png){fig-align="center" width="200"}
:::
:::

## Discrimination

This is the most known and used category of performance metrics and curves.

## Discrimination

**üíä** <br> ü§¢

```{r}

  
  
tibble::tribble(
  ~"type", ~"predicted_positive", ~"predicted_negative",
  "Real Positive", "TP", "FN",
  "Real Negative", "FP", "TN"
) |> 
  reactable::reactable(
    theme = reactable::reactableTheme(
      backgroundColor = "#fdf6e3"
    ),
    sortable = FALSE,
            fullWidth = FALSE,
            borderless = FALSE,
            defaultColDef = reactable::colDef(
              align = "center",
              headerStyle  = list(fontWeight = 100)
            ),
            columns = list(
              type = reactable::colDef(
                name = "",
                align = "left",
                style = list(fontWeight = 100),
                minWidth = 200
              ),
              predicted_positive = reactable::colDef(
                name = "Predicted Positive",
                style = function(value) {
                  color <- if (value == "TP") {
                    "lightgreen"
                  }
                  
                  list(fontWeight = 600, background = color)
                },
                minWidth = 200
            ),
            predicted_negative = reactable::colDef(
              name = "Predicted Negative",
              style = function(value) {
                list(fontWeight = 600)
              },
                minWidth = 200
            )
            )
  )
```

## Discrimination

#### Performance Metrics derived by using a Probability Threshold:

Most Performance Metrics are estimated by using a Probability Threshold in order to classify each probability to Predicted Negative or Predicted Positive.

This type of Binarization is being used when the intervention carries a potential risk and there is a trade-off of risks between the intervention and the outcome.

## Discrimination

#### Performance Metrics derived by using a Predicted Positives Conditional Rate:

A different type of Binarization is the Predicted Positives Conditional Rate (also known in healthcare as "Risk Percentile").

PPCR (Predicted Positives Condition Rate:

$\begin{aligned} \ {\scriptsize \frac{\text{TP + FP}}{\text{TP + FP + TN + FN}}}\end{aligned}$

## Discrimination - Common Performance Metrics:

<br>

Sensitivity: $\begin{aligned} \ {\scriptsize \frac{\text{TP}}{\text{TP + FN}} = \text{Prob( Predicted Positive | Real Positive )}}\end{aligned}$

<br>

Specificity: $\begin{aligned} \ {\scriptsize \frac{\text{TP}}{\text{TP + FN}} = \text{Prob( Predicted Positive | Real Positive )} } \end{aligned}$

## Discrimination - ROC Curve
